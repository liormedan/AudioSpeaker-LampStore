# סקירת פרויקט והצעות לשיפור

## סקירה כללית
מסמך זה מספק סקירה של בסיס הקוד הנוכחי, תוך התמקדות בקומפוננטה `StoreShowroom`, יישום התאורה ואיכות הקוד הכללית. הוא כולל המלצות ספציפיות לשיפורים על סמך הניתוח.

## 1. יישום תאורה ופרמטרים

### ניתוח פערים
קיים הבדל משמעותי בין הערכים ב-`LIGHTING_PARAMETERS.md` לבין הקוד בפועל ב-`components/lighting/dynamic-lighting.tsx`.

**ערכי קוד נוכחיים:**
- `ambientIntensity`: מינימום **0.05**, מקסימום **6.0**
- `directionalIntensity`: מינימום **0.1**, מקסימום **12.0**

**מוצע במסמך התיעוד (ללילות חשוכים יותר):**
- `ambientIntensity`: מינימום **0.01**
- `directionalIntensity`: מינימום **0.01**

**אבחנה:**
נראה שהקוד עודכן להיות *בהיר יותר* באופן כללי (הערות בקוד מציינות "INCREASED VALUES FOR BRIGHTER LIGHTING"), מה שסותר את המטרה של "מצב לילה" חשוך מאוד שבו מנורת התקרה היא המקור העיקרי.

### המלצה
כדי להשיג את אפקט "החדר החשוך" שבו המנורה היא הכוכב:
1.  **הנמכת המינימום**: שנה את ערכי ה-`min` ב-`DynamicLighting` ל-`0.01` או אפילו `0.005` כדי לאפשר חושך אמיתי.
2.  **התאמת העקומה**: העקומה הנוכחית `Math.pow(darkness, 1.8)` טובה, אבל אולי כדאי עקומה תלולה יותר (למשל, חזקה של 2.5) כדי לשמור על החדר מואר בטווח "היום" ולרדת מהר לחושך.

## 2. מבנה קוד וארגון מחדש (Refactoring)

### קומפוננטת `StoreShowroom`
הקובץ `components/store-showroom.tsx` נהיה גדול מדי (מעל 460 שורות) ומטפל ביותר מדי תחומי אחריות.

**הצעות:**
1.  **הוצאת מנורות תלייה**: החלק של "Ceiling Pendant Lights" (שורות 221-404) מכיל JSX שחוזר על עצמו.
    -   צור קומפוננטה `CeilingPendant` שמקבלת `position`, `type` ו-`onSelect`.
    -   זה יקטין את הקובץ הראשי בכ-150 שורות ויקל על הוספת מנורות נוספות.
2.  **הוצאת הגדרות סביבה**: את המרצפות, הקירות וקורת העץ אפשר להעביר לקומפוננטה `ShowroomEnvironment`.
3.  **הפרדת קונפיגורציה**: את הקבוע `DISPLAY_LAMPS` אפשר להעביר לקובץ קונפיגורציה נפרד (למשל `lib/constants.ts`) כדי להפריד נתונים מתצוגה.

## 3. אופטימיזציית ביצועים

### רמת פירוט (LOD)
הקומפוננטה `LampDisplayWithLOD` היא התחלה מצוינת, אבל כרגע היא מרנדרת פירוט מלא בכל המרחקים.
-   **פעולה**: ממש לוגיקה של פישוט גיאומטריה או הסתרת פרטים קטנים (כמו מתגים/ברגים) כאשר `distance > 10`.

### טעינת טקסטורות
-   **פעולה**: ה-`useModelPreloader` טוב. וודא ש-`useTexture` בחומרי ה-PBR מטפל גם הוא ב-preloading או משתמש ב-`Suspense` בצורה נכונה כדי למנוע "קפיצות" (pop-in).

### אופטימיזציית צללים
-   **פעולה**: אתה משתמש ב-`shadow-mapSize={2048}`. למובייל או מכשירים חלשים יותר, שקול להוריד ל-`1024` או להשתמש ב-`softShadows` מ-`drei` שנראה טוב גם ברזולוציות נמוכות יותר.

## 4. בטיחות טיפוסים (Type Safety) ותחזוקה

-   **ערכים קבועים (Hardcoded)**: יש הרבה "מספרי קסם" למיקומים וצבעים. העבר אותם לקובץ theme או constants.
-   **טיפוסים**: וודא שהטיפוס `Lamp` משותף ועקבי בין כל הקומפוננטות.

## 5. שיפורי קוד ספציפיים

### `components/lighting/rect-area-light.tsx`
הקריאה ל-`RectAreaLightUniformsLib.init()` בתוך `useEffect` בטוחה בגלל הדגל, אבל עדיף לאתחל את זה פעם אחת בנקודת הכניסה לאפליקציה (למשל `app/layout.tsx` או `ClientLayout` עליון) כדי להבטיח שזה מוכן לפני כל רינדור.

### `components/store-showroom.tsx`
ה-`EffectComposer` עם `SSAO` ו-`Bloom` הוא כבד לביצועים.
-   **הצעה**: הוסף כפתור "מצב איכות נמוכה" שמבטל את `EffectComposer` לשיפור FPS במחשבים ניידים/מובייל.

## סיכום משימות לביצוע
1.  [ ] ארגון מחדש של `StoreShowroom` להוצאת `CeilingPendant` ו-`ShowroomEnvironment`.
2.  [ ] עדכון ערכי מינימום ב-`DynamicLighting` ל-`0.01` למצב לילה טוב יותר.
3.  [ ] מימוש לוגיקת LOD אמיתית ב-`LampDisplayWithLOD`.
4.  [ ] העברת `DISPLAY_LAMPS` לקובץ קונפיגורציה.
